timeout: 600s
steps:
- id: init
  waitFor: ['-']
  name: 'gcr.io/cloud-builders/npm'
  args: ['install']

- id: frontendTest
  waitFor: ['init']
  name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'f-test']

- id: backendTest
  waitFor: ['init']
  name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'b-test']

- id: buildAssets
  waitFor: ['frontendTest', 'backendTest']
  name: 'gcr.io/cloud-builders/npm'
  args: ['run', 'build']

- id: appEngineDeploy
  waitFor: ['buildAssets']
  name: 'gcr.io/cloud-builders/gcloud'
  args: ['app', 'deploy', '-q', '--project', '$PROJECT_ID']

- id: cloudRunDeploy
  waitFor: ['buildAssets']
  name: 'gcr.io/cloud-builders/gcloud'
  entrypoint: 'sh'
  args: 
    - -c
    - |
      gcloud builds submit --tag gcr.io/$PROJECT_ID/hi:1 -q
      gcloud beta run deploy --image gcr.io/$PROJECT_ID/hi:1 -q --allow-unauthenticated --platform="managed" --region="us-central1" slides